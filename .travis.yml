language: php

php:
  - 7.1
  - 7.2
  - 7.3
  - 7.4
  - nightly

before_script:
  - |
    if [ $TRAVIS_PHP_VERSION == "nightly" ]; then
      # not all dependencies advertise PHP 8 support yet
      composer config platform.php 7.4.0
    fi
  - composer install

script:
  - |
    if [ $TRAVIS_PHP_VERSION == "nightly" ]; then
      vendor/bin/phpunit
    else
      mkdir -p build/logs
      vendor/bin/phpunit --coverage-clover build/logs/clover.xml
    fi

after_script:
  - vendor/bin/php-coveralls -v

jobs:
  include:
    - php: 7.4
      name: Psalm
      script: vendor/bin/psalm.phar
